# H2 en memoire (mode MySQL)
spring.datasource.url=jdbc:h2:mem:assurance_test;DB_CLOSE_DELAY=-1;MODE=MySQL;DATABASE_TO_UPPER=false
spring.datasource.driver-class-name=org.h2.Driver
spring.datasource.username=sa
spring.datasource.password=

spring.jpa.hibernate.ddl-auto=create-drop
spring.jpa.database-platform=org.hibernate.dialect.H2Dialect
spring.jpa.show-sql=false

# Desactiver migrations / init auto pendant les tests
spring.liquibase.enabled=false
spring.flyway.enabled=false
spring.sql.init.mode=never

# Security test: ne jamais appeler un vrai endpoint JWK
spring.security.oauth2.resourceserver.jwt.jwk-set-uri=http://localhost:0

# Autoriser les beans/mocks de test a surcharger
spring.main.allow-bean-definition-overriding=true

# Pas de taches planifiees en tests
spring.task.scheduling.enabled=false

# URLs factices pour services ML (evite tout appel externe)
ml.service.v1.url=http://localhost:0
ml.service.v2.url=http://localhost:0

# Configuration de test pour éviter les erreurs de contexte
spring.test.context.cache.maxSize=1
logging.level.org.springframework.test=WARN
logging.level.org.springframework.boot.test=WARN

# Désactiver l'auto-configuration problématique
spring.autoconfigure.exclude=org.springframework.boot.autoconfigure.security.oauth2.client.servlet.OAuth2ClientAutoConfiguration


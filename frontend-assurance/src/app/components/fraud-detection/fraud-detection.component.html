<div class="container-fluid">
  <div class="row">
    <div class="col-12">
      <h2 class="mb-4">
        <i class="fas fa-search me-2 text-primary"></i>
        Détection de Fraude ML
      </h2>
    </div>
  </div>

  <!-- Formulaire de test -->
  <div class="row">
    <div class="col-md-8">
      <div class="card">
        <div class="card-header">
          <h5 class="mb-0">Données du Contrat</h5>
        </div>
        <div class="card-body">
          <form [formGroup]="fraudForm" (ngSubmit)="onSubmit()">

            <!-- Informations Client -->
            <div class="row mb-3">
              <div class="col-12">
                <h6 class="text-muted">Informations Client</h6>
              </div>
              <div class="col-md-6">
                <label class="form-label">Prénom</label>
                <input type="text" class="form-control" formControlName="firstName">
              </div>
              <div class="col-md-6">
                <label class="form-label">Nom</label>
                <input type="text" class="form-control" formControlName="lastName">
              </div>
            </div>

            <!-- Données Contrat -->
            <div class="row mb-3">
              <div class="col-12">
                <h6 class="text-muted">Données du Contrat</h6>
              </div>
              <div class="col-md-4">
                <label class="form-label">ID Contrat</label>
                <input type="text" class="form-control" formControlName="contractId">
              </div>
              <div class="col-md-4">
                <label class="form-label">RC</label>
                <input type="number" class="form-control" formControlName="rc">
              </div>
              <div class="col-md-4">
                <label class="form-label">D_rec</label>
                <input type="number" class="form-control" formControlName="dRec">
              </div>
            </div>

            <!-- Garanties -->
            <div class="row mb-3">
              <div class="col-12">
                <h6 class="text-muted">Garanties</h6>
              </div>
              <div class="col-md-3">
                <label class="form-label">Incendie</label>
                <input type="number" class="form-control" formControlName="incendie">
              </div>
              <div class="col-md-3">
                <label class="form-label">Vol</label>
                <input type="number" class="form-control" formControlName="vol">
              </div>
              <div class="col-md-3">
                <label class="form-label">Dommages Véhicule</label>
                <input type="number" class="form-control" formControlName="dommagesAuVehicule">
              </div>
              <div class="col-md-3">
                <label class="form-label">Bris de Glaces</label>
                <input type="number" class="form-control" formControlName="brisDeGlaces">
              </div>
            </div>

            <!-- Montants -->
            <div class="row mb-3">
              <div class="col-12">
                <h6 class="text-muted">Montants</h6>
              </div>
              <div class="col-md-4">
                <label class="form-label">Total Prime Nette</label>
                <input type="number" class="form-control" formControlName="totalPrimeNette">
              </div>
              <div class="col-md-4">
                <label class="form-label">Valeur Catalogue</label>
                <input type="number" class="form-control" formControlName="valeurCatalogue">
              </div>
              <div class="col-md-4">
                <label class="form-label">Valeur Vénale</label>
                <input type="number" class="form-control" formControlName="valeurVenale">
              </div>
            </div>

            <!-- Boutons -->
            <div class="row">
              <div class="col-12">
                <button type="submit" class="btn btn-primary me-2" [disabled]="isLoading">
                  <i class="fas fa-search me-1"></i>
                  {{ isLoading ? 'Analyse en cours...' : 'Analyser Fraude' }}
                </button>
                <button type="button" class="btn btn-secondary me-2" (click)="loadTestData()">
                  <i class="fas fa-flask me-1"></i>
                  Données Test
                </button>
                <button type="button" class="btn btn-warning" (click)="loadHighRiskData()">
                  <i class="fas fa-exclamation-triangle me-1"></i>
                  Test Alerte
                </button>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Résultats -->
    <div class="col-md-4">
      <div class="card" *ngIf="lastResult">
        <div class="card-header" [class]="getResultHeaderClass()">
          <h5 class="mb-0 text-white">
            <i [class]="getResultIcon()"></i>
            Résultat de l'Analyse
          </h5>
        </div>
        <div class="card-body">
          <div class="mb-3">
            <strong>Fraude Détectée:</strong>
            <span class="badge ms-2" [class]="lastResult.prediction.isFraud ? 'bg-danger' : 'bg-success'">
              {{ lastResult.prediction.isFraud ? 'OUI' : 'NON' }}
            </span>
          </div>

          <div class="mb-3">
            <strong>Probabilité:</strong>
            <div class="progress mt-1">
              <div class="progress-bar"
                   [class]="getProbabilityBarClass()"
                   [style.width.%]="lastResult.prediction.fraudProbability * 100">
                {{ (lastResult.prediction.fraudProbability * 100).toFixed(1) }}%
              </div>
            </div>
          </div>

          <div class="mb-3">
            <strong>Confiance:</strong>
            <span class="badge bg-info ms-2">
                 {{ (lastResult.confidence * 100).toFixed(1) }}%
            </span>
          </div>

          <div class="mb-3">
            <strong>Niveau de Risque:</strong>
            <span class="badge ms-2" [class]="getRiskLevelClass()">
              {{ lastResult.prediction.riskLevel }}
            </span>
          </div>

          <!-- Alerte générée -->
          <div *ngIf="alertGenerated" class="alert alert-warning">
            <i class="fas fa-bell me-2"></i>
            <strong>Alerte générée!</strong><br>
            Une alerte de fraude a été créée automatiquement.
          </div>
        </div>
      </div>

      <!-- Statistiques des tests -->
      <div class="card mt-3">
        <div class="card-header">
          <h6 class="mb-0">Statistiques des Tests</h6>
        </div>
        <div class="card-body">
          <div class="row text-center">
            <div class="col-6">
              <h4 class="text-primary">{{ testStats.total }}</h4>
              <small>Tests Total</small>
            </div>
            <div class="col-6">
              <h4 class="text-danger">{{ testStats.fraudDetected }}</h4>
              <small>Fraudes Détectées</small>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
